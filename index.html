<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.0/TweenMax.min.js"></script>
    <script tpe="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/lettering.js/0.6.1/jquery.lettering.min.js"></script>
    <script src="index.js"></script>
    <link rel="stylesheet" href="index.css" type="text/css">
    <title>current Weather</title>
    <style>

        
    </style>
</head>

<body>
    <header id="head_container">
        <div style="width:1000px; text-align: center; margin:0 auto;">
            <div class="container">
                <h1>
                    <span class="title">아두이노 센서</span>
                    <span class="title">공공데이터 API</span>
                    <span class="title">불러오기</span>
                </h1>
            </div>
        </div>
    </header>
    <section>
        <div id="section_container">
            <div id="inside_section_container">
                <div class="button">데이터 불러오기</div>
                <span class="reload_weather"></span>
                <br>
                <span class="reload_Air_Pollution"></span>
                <hr />
                <h1 id="clock" style="color:gray; cursor:default;">00:00</h1>

                <table id="section_table_1">
                    <tr>
                        <th></th>
                        <th>공공데이터 측정값</th>
                        <th>아두이노 센서 측정값</th>
                    </tr>
                    <tr>
                        <td>강수형태</td>
                        <td id='P1'></td>
                        <td id='Rain_Type_Arduino'></td>
                    </tr>
                    <tr>
                        <td>습도</td>
                        <td id='P2'></td>
                        <td id='Huminity_Arduino'></td>
                    </tr>
                    <tr>
                        <td>온도</td>
                        <td id='P4'></td>
                        <td id='Temperature_Arduino'></td>
                    </tr>
                    <tr>
                        <td>풍속</td>
                        <td id='P5'></td>
                        <td id='Wind_Speed_Arduino'></td>
                    </tr>
                    <tr>
                        <td>미세먼지</td>
                        <td id='P6'></td>
                        <td id='Air_Pollution_Arduino'></td>
                    </tr>
                </table>
                <div id='Compare_Rain_Type'>
                    <span id="arduino_Rain_Type_Pos"
                        style="font-size : 8px; position : relative; right: 20%; top :20px">아두이노→</span>
                    <span style="font-size : 8px; position : relative; left:21%; top :20px">←공공데이터</span>

                    <table id="section_table_1" style="width: 400px;margin:0 auto;">
                        <tr>
                            <th colspan="2" style="width:18%">강수형태 등급</th>
                        </tr>
                        <tr>
                            <td colspan="2" class="level_Color_0">비 안내림</td>
                        </tr>
                        <tr>
                            <td colspan="2" class="level_Color_1">비</td>
                        </tr>
                        <tr>
                            <td class="level_Color_2">소나기</td>
                            <td style=" border : 0"></td>
                        </tr>
                        <tr>
                            <td class="level_Color_3">빗방울</td>
                            <td frameborder = "0" style=" border : 0"></td>
                            </td>
                        </tr>
                        <tr>
                            <td class="level_Color_4">약한 진눈깨비</td>
                            <td style="border : 0"></td>
                        </tr>
                        <tr>
                            <td class="level_Color_5">눈날림</td>
                            <td style="border : 0"></td>
                        </tr>
                    </table>
                </div>
                <div id='Compare_Huminity'>
                    <span id="arduino_WInd_Pos"
                        style="font-size : 8px; position : relative; right: 20%; top :20px">아두이노→</span>
                    <span style="font-size : 8px; position : relative; left:21%; top :20px">←공공데이터</span>

                    <table id="section_table_1" style="width: 400px;margin:0 auto;">
                        <tr>
                            <th style="width:20%">등급</th>
                            <th style="width:18%">바람 세기(m/s)</th>
                            <th style="width:62%">해설</th>
                        </tr>
                        <tr>
                            <td class="level_Color_0">0등급</tㅇ>
                            <td>0~0.2</td>
                            <td>연기가 위로 똑바르게 올라가는 상태<p></p>
                            </td>
                        </tr>
                        <tr>
                            <td class="level_Color_1">1등급</td>
                            <td>0.3~1.5</td>
                            <td>연기가 날리는 것은 알 수 있으나, 바람개비로는 감지 불가</td>
                        </tr>
                        <tr>
                            <td class="level_Color_2">2등급</td>
                            <td>1.6~3.3</td>
                            <td>얼굴로 바람이 느껴지고 나뭇잎이 흔들리고 바람개비로 감지 가능</td>
                        </tr>
                        <tr>
                            <td class="level_Color_3">3등급</td>
                            <td>3.4~5.4</td>
                            <td>나뭇잎과 가는 가지가 쉴새 없이 흔들림<p></p>
                            </td>
                        </tr>
                        <tr>
                            <td class="level_Color_4">4등급</td>
                            <td>5.5~7.9</td>
                            <td>먼지가 일고 종이 조각이 날리며 작은 나뭇가지가 흔들리는 정도</td>
                        </tr>
                        <tr>
                            <td class="level_Color_5">5등급</td>
                            <td>8~10.7</td>
                            <td>잎이 무성한 작은 나무 전체가 흔들리고 강물에 잔물결이 일어남</td>
                        </tr>
                    </table>
                </div>
                <div id='Compare_Temperature'>
                    <span id="arduino_WInd_Pos"
                        style="font-size : 8px; position : relative; right: 20%; top :20px">아두이노→</span>
                    <span style="font-size : 8px; position : relative; left:21%; top :20px">←공공데이터</span>

                    <table id="section_table_1" style="width: 400px;margin:0 auto;">
                        <tr>
                            <th style="width:20%">등급</th>
                            <th style="width:18%">바람 세기(m/s)</th>
                            <th style="width:62%">해설</th>
                        </tr>
                        <tr>
                            <td class="level_Color_0">0등급</tㅇ>
                            <td>0~0.2</td>
                            <td>연기가 위로 똑바르게 올라가는 상태<p></p>
                            </td>
                        </tr>
                        <tr>
                            <td class="level_Color_1">1등급</td>
                            <td>0.3~1.5</td>
                            <td>연기가 날리는 것은 알 수 있으나, 바람개비로는 감지 불가</td>
                        </tr>
                        <tr>
                            <td class="level_Color_2">2등급</td>
                            <td>1.6~3.3</td>
                            <td>얼굴로 바람이 느껴지고 나뭇잎이 흔들리고 바람개비로 감지 가능</td>
                        </tr>
                        <tr>
                            <td class="level_Color_3">3등급</td>
                            <td>3.4~5.4</td>
                            <td>나뭇잎과 가는 가지가 쉴새 없이 흔들림<p></p>
                            </td>
                        </tr>
                        <tr>
                            <td class="level_Color_4">4등급</td>
                            <td>5.5~7.9</td>
                            <td>먼지가 일고 종이 조각이 날리며 작은 나뭇가지가 흔들리는 정도</td>
                        </tr>
                        <tr>
                            <td class="level_Color_5">5등급</td>
                            <td>8~10.7</td>
                            <td>잎이 무성한 작은 나무 전체가 흔들리고 강물에 잔물결이 일어남</td>
                        </tr>
                    </table>
                </div>
                <div id='Compare_Wind_Speed'>
                    <span id="arduino_WInd_Pos"
                        style="font-size : 8px; position : relative; right: 20%; top :20px">아두이노→</span>
                    <span style="font-size : 8px; position : relative; left:21%; top :20px">←공공데이터</span>

                    <table id="section_table_1" style="width: 400px;margin:0 auto;">
                        <tr>
                            <th style="width:20%">등급</th>
                            <th style="width:18%">바람 세기(m/s)</th>
                            <th style="width:62%">해설</th>
                        </tr>
                        <tr>
                            <td class="level_Color_0">0등급</tㅇ>
                            <td>0~0.2</td>
                            <td>연기가 위로 똑바르게 올라가는 상태<p></p>
                            </td>
                        </tr>
                        <tr>
                            <td class="level_Color_1">1등급</td>
                            <td>0.3~1.5</td>
                            <td>연기가 날리는 것은 알 수 있으나, 바람개비로는 감지 불가</td>
                        </tr>
                        <tr>
                            <td class="level_Color_2">2등급</td>
                            <td>1.6~3.3</td>
                            <td>얼굴로 바람이 느껴지고 나뭇잎이 흔들리고 바람개비로 감지 가능</td>
                        </tr>
                        <tr>
                            <td class="level_Color_3">3등급</td>
                            <td>3.4~5.4</td>
                            <td>나뭇잎과 가는 가지가 쉴새 없이 흔들림<p></p>
                            </td>
                        </tr>
                        <tr>
                            <td class="level_Color_4">4등급</td>
                            <td>5.5~7.9</td>
                            <td>먼지가 일고 종이 조각이 날리며 작은 나뭇가지가 흔들리는 정도</td>
                        </tr>
                        <tr>
                            <td class="level_Color_5">5등급</td>
                            <td>8~10.7</td>
                            <td>잎이 무성한 작은 나무 전체가 흔들리고 강물에 잔물결이 일어남</td>
                        </tr>
                    </table>
                </div>
                <div id='Compare_Air_Pollution'>
                    <span id="arduino_WInd_Pos"
                        style="font-size : 8px; position : relative; right: 20%; top :20px">아두이노→</span>
                    <span style="font-size : 8px; position : relative; left:21%; top :20px">←공공데이터</span>

                    <table id="section_table_1" style="width: 400px;margin:0 auto;">
                        <tr>
                            <th style="width:20%">등급</th>
                            <th style="width:18%">바람 세기(m/s)</th>
                            <th style="width:62%">해설</th>
                        </tr>
                        <tr>
                            <td class="level_Color_0">0등급</tㅇ>
                            <td>0~0.2</td>
                            <td>연기가 위로 똑바르게 올라가는 상태<p></p>
                            </td>
                        </tr>
                        <tr>
                            <td class="level_Color_1">1등급</td>
                            <td>0.3~1.5</td>
                            <td>연기가 날리는 것은 알 수 있으나, 바람개비로는 감지 불가</td>
                        </tr>
                        <tr>
                            <td class="level_Color_2">2등급</td>
                            <td>1.6~3.3</td>
                            <td>얼굴로 바람이 느껴지고 나뭇잎이 흔들리고 바람개비로 감지 가능</td>
                        </tr>
                        <tr>
                            <td class="level_Color_3">3등급</td>
                            <td>3.4~5.4</td>
                            <td>나뭇잎과 가는 가지가 쉴새 없이 흔들림<p></p>
                            </td>
                        </tr>
                        <tr>
                            <td class="level_Color_4">4등급</td>
                            <td>5.5~7.9</td>
                            <td>먼지가 일고 종이 조각이 날리며 작은 나뭇가지가 흔들리는 정도</td>
                        </tr>
                        <tr>
                            <td class="level_Color_5">5등급</td>
                            <td>8~10.7</td>
                            <td>잎이 무성한 작은 나무 전체가 흔들리고 강물에 잔물결이 일어남</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </section>
    <footer>
        <center>
            <div id="footer_container">

            </div>
        </center>
    </footer>
    <script>
        //API로 공공데이터 불러오기
        const header = document.querySelector('header');
        const section = document.querySelector('section');
        const footer = document.querySelector('footer');
        //footer.appendChild(myPara1); querySelector 사용법

        const myPara1 = document.getElementById('P1');
        const myPara2 = document.getElementById('P2');
        const myPara3 = document.getElementById('P3');
        const myPara4 = document.getElementById('P4');
        const myPara5 = document.getElementById('P5');
        const myPara6 = document.getElementById('P6');

        var xhr1 = new XMLHttpRequest();
        function weather_Check() {
            xhr1.open("GET", "get_weather.php");
            xhr1.send();
            $('.reload_weather').text('기상 데이터 로딩중...');
            $(".reload_weather").lettering();
            console_clock();
            console.log("run xhr1.open & xhr1.send\n");
        }

        xhr1.onload = function () {
            $('.reload_weather').text('기상 데이터 로딩 완료');
            $(".reload_weather").lettering();
            console_clock();
            console.log("xhr1.onload readyState =" + xhr1.readyState + ", status = " + xhr1.status + "\n");
            if (xhr1.readyState == 4 && xhr1.status == 200) {
                const weather_data = xhr1.response;
                console.log(weather_data);
                const weather_Parsed_Data = JSON.parse(weather_data);
                currentWeather(weather_Parsed_Data);
            }
            else {
                $('.reload_weather').text('기상 데이터 로딩 실패');
                $(".reload_weather").lettering();
                console_clock();
                console.log("기상 데이터 불러오기 실패\n");
            }
        }

        function currentWeather(obj) {
            const item = obj.response.body.items.item;
            for (var i = 0; i < item.length; i++) {
                const obser_V = item[i].obsrValue;
                const cat = item[i].category;
                if (cat == "PTY") {
                    if (obser_V == 0) {
                        myPara1.innerHTML = '비 안내림';
                    }
                    else if (obser_V == 1) {
                        myPara1.innerHTML = '비';
                    }
                    else if (obser_V == 2) {
                        myPara1.innerHTML = '강한 진눈깨비';
                    }
                    else if (obser_V == 3) {
                        myPara1.innerHTML = '눈';
                    }
                    else if (obser_V == 4) {
                        myPara1.innerHTML = '소나기';
                    }
                    else if (obser_V == 5) {
                        myPara1.innerHTML = '빗방울';
                    }
                    else if (obser_V == 6) {
                        myPara1.innerHTML = '약한 진눈깨비';
                    }
                    else if (obser_V == 7) {
                        myPara1.innerHTML = '눈날림';
                    }
                }
                else if (cat == "REH") {
                    myPara2.innerHTML = obser_V + '%';
                }
                else if (cat == "RN1") {
                    myPara3.innerHTML = obser_V + 'mm';
                }
                else if (cat == "T1H") {
                    myPara4.innerHTML = obser_V + '℃';
                }
                else if (cat == "WSD") {
                    myPara5.innerHTML = obser_V + 'm/s';
                    var a = 61;
                    if (obser_V <= 0.2) {
                        $('#arduino_WInd_Pos').css({ "position": "relative", "top": a + "px" });
                    }
                    else if (obser_V <= 1.5) {
                        $('#arduino_WInd_Pos').css({ "position": "relative", "top": a + 30 + "px" });
                    }
                    else if (obser_V <= 3.3) {
                        $('#arduino_WInd_Pos').css({ "position": "relative", "top": a + 62 + "px" });
                    }
                    else if (obser_V <= 5.4) {
                        $('#arduino_WInd_Pos').css({ "position": "relative", "top": a + 93 + "px" });
                    }
                    else if (obser_V <= 7.9) {
                        $('#arduino_WInd_Pos').css({ "position": "relative", "top": a + 125 + "px" });
                    }
                    else if (obser_V <= 10.7) {
                        $('#arduino_WInd_Pos').css({ "position": "relative", "top": a + 160 + "px" });
                    }
                }
            }
        }

        var xhr2 = new XMLHttpRequest();
        function air_Pollution_Check() {
            xhr2.open("GET", "get_Air_Pollution.php");
            xhr2.send();
            $('.reload_Air_Pollution').text('미세먼지 데이터 로딩중...');
            $(".reload_Air_Pollution").lettering();
            console_clock();
            console.log("run xhr2.open & xhr2.send \n");
        }
        xhr2.onload = function () {
            $('.reload_Air_Pollution').text('미세먼지 데이터 로딩 완료');
            $(".reload_Air_Pollution").lettering();
            console_clock();
            console.log("xhr2.onload readyState =" + xhr2.readyState + ", status =" + xhr2.status + "\n");
            if (xhr2.readyState == 4 && xhr2.status == 200) {
                let Air_Pollution = xhr2.response;
                let Air_Pollution_Parsed_Data = JSON.parse(Air_Pollution);
                current_Air_Pollution(Air_Pollution_Parsed_Data);
            }
            else {
                $('.reload_Air_Pollution').text('미세먼지 데이터 로딩 실패');
                $(".reload_Air_Pollution").lettering();
                console_clock();
                console.log("미세먼지 API 불러오기 실패\n");
            }

        }
        function current_Air_Pollution(obj) {
            const item = obj.response.body.items[0];
            const pm10Value = item.pm10Value;
            myPara6.innerHTML = pm10Value + "㎍/㎥";
        }

        const xhr3 = new XMLHttpRequest();
        function get_WebPage() {
            xhr3.open("GET", "get_WebPage.php");
            xhr3.send();
        }
        xhr3.onload = function () {
            console_clock();
            console.log("xhr3.onload readyState =" + xhr3.readyState + ", status =" + xhr3.status + "\n");
            if (xhr3.readyState == 4 && xhr3.status == 200) {
                console.log("get_WebPage 결과값 : " + xhr3.response);
            }
            else {
                $('.reload_weather').text('기상 데이터 로딩 실패');
                $(".reload_weather").lettering();
                console_clock();
                console.log("기상 데이터 불러오기 실패\n");
            }
        }



        function clock() {
            //실시간 시간 표시하기
            var clockTarget = document.getElementById("clock");
            var date = new Date();
            // date Object를 받아오고 
            var year = date.getFullYear();
            var month = date.getMonth();
            // 달을 받아옵니다 
            var clockDate = date.getDate();
            // 몇일인지 받아옵니다 
            var day = date.getDay();
            // 요일을 받아옵니다. 
            var week = ['일', '월', '화', '수', '목', '금', '토'];
            // 요일은 숫자형태로 리턴되기때문에 미리 배열을 만듭니다. 
            var hours = date.getHours();
            // 시간을 받아오고 
            var minutes = date.getMinutes();
            // 분도 받아옵니다.
            var seconds = date.getSeconds();
            // 초까지 받아온후 
            clockTarget.innerText = `${month + 1}월 ${clockDate}일 ${week[day]}요일 ` + `${hours < 10 ? `0${hours}` : hours}:${minutes < 10 ? `0${minutes}` : minutes}:${seconds < 10 ? `0${seconds}` : seconds}`;
            // 월은 0부터 1월이기때문에 +1일을 해주고 
            // 시간 분 초는 한자리수이면 시계가 어색해보일까봐 10보다 작으면 앞에0을 붙혀주는 작업을 3항연산으로 했습니다. 

            if ((minutes == 00 || minutes == 10 || minutes == 20 || minutes == 30 || minutes == 40 || minutes == 50 || minutes == 60) && (seconds == 00 || seconds == 10 || seconds == 20 || seconds == 30 || seconds == 40 || seconds == 50 || seconds == 60)) {
                weather_Check();
                air_Pollution_Check();
            }
        }

        function console_clock() {
            //실시간 시간 표시하기
            var clockTarget = document.getElementById("clock");
            var date = new Date();
            // date Object를 받아오고 
            var year = date.getFullYear();
            var month = date.getMonth();
            // 달을 받아옵니다 
            var clockDate = date.getDate();
            // 몇일인지 받아옵니다 
            var day = date.getDay();
            // 요일을 받아옵니다. 
            var week = ['일', '월', '화', '수', '목', '금', '토'];
            // 요일은 숫자형태로 리턴되기때문에 미리 배열을 만듭니다. 
            var hours = date.getHours();
            // 시간을 받아오고 
            var minutes = date.getMinutes();
            // 분도 받아옵니다.
            var seconds = date.getSeconds();
            // 초까지 받아온후 
            console.log(year + '/' + (month + 1) + '/' + clockDate + ' _ ' + hours + ':' + minutes + ':' + seconds);
        }
        $(".button").click(
            function () {
                weather_Check();
                air_Pollution_Check();
                get_WebPage();
                var title1 = new TimelineMax();

                title1.to(".reload_weather", 0, { visibility: 'hidden', opacity: 0 });
                title1.to(".reload_weather", 0.4, { visibility: 'visible', opacity: 1 });
                title1.to(".reload_Air_Pollution", 0, { visibility: 'hidden', opacity: 0 });
                title1.to(".reload_Air_Pollution", 0.4, { visibility: 'visible', opacity: 1 });
            });

        function init() {
            clock();
            weather_Check();
            air_Pollution_Check();
            get_WebPage();
            // 최초에 함수를 한번 실행시켜주고 
            setInterval(clock, 1000);
            // setInterval이라는 함수로 매초마다 실행을 해줍니다.
            // setInterval은 첫번째 파라메터는 함수이고 두번째는 시간인데 밀리초단위로 받습니다. 1000 = 1초 
        }
        init();

    </script>
    <!-- 크롤링 코드 -->

</body>

</html>